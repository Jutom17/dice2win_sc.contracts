const Web3 = require('web3');

var web3 = new Web3('http://18.179.206.91:8545');  //rinkeby
//const web3 = new Web3('ws://54.249.21.74:8546'); //mainnet
//const web3 = new Web3('http://54.249.21.74:8545'); //mainnet

const Tx = require('ethereumjs-tx')

const paymentABI = [ { "constant": true, "inputs": [], "name": "settle_window_min", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "channelCounter", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "bytes32" } ], "name": "channels", "outputs": [ { "name": "state", "type": "uint8" }, { "name": "settleBlock", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "bytes32" } ], "name": "participantsHash_to_channelCounter", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "settle_window_max", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "game", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "bytes32" }, { "name": "", "type": "address" } ], "name": "lockIdentifier_to_lockedAmount", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "_game", "type": "address" }, { "name": "_settle_window_min", "type": "uint256" }, { "name": "_settle_window_max", "type": "uint256" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "participant1", "type": "address" }, { "indexed": true, "name": "participant2", "type": "address" }, { "indexed": false, "name": "channelIdentifier", "type": "bytes32" }, { "indexed": false, "name": "settle_timeout", "type": "uint256" }, { "indexed": false, "name": "amount", "type": "uint256" } ], "name": "ChannelOpened", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channel_identifier", "type": "bytes32" }, { "indexed": true, "name": "participant", "type": "address" }, { "indexed": false, "name": "total_deposit", "type": "uint256" } ], "name": "ChannelNewDeposit", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channelIdentifier", "type": "bytes32" }, { "indexed": false, "name": "participant1_balance", "type": "uint256" }, { "indexed": false, "name": "participant2_balance", "type": "uint256" } ], "name": "CooperativeSettled", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channel_identifier", "type": "bytes32" }, { "indexed": true, "name": "closing", "type": "address" }, { "indexed": false, "name": "balanceHash", "type": "bytes32" } ], "name": "ChannelClosed", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channel_identifier", "type": "bytes32" }, { "indexed": true, "name": "nonclosing", "type": "address" }, { "indexed": false, "name": "balanceHash", "type": "bytes32" } ], "name": "NonclosingUpdateBalanceProof", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channelIdentifier", "type": "bytes32" }, { "indexed": true, "name": "lockedIdentifier", "type": "bytes32" }, { "indexed": false, "name": "participant", "type": "address" }, { "indexed": false, "name": "transferToParticipantAmount", "type": "uint256" } ], "name": "ChannelSettled", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channelIdentifier", "type": "bytes32" }, { "indexed": true, "name": "beneficiary", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" } ], "name": "ChannelLockedSent", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "channelIdentifier", "type": "bytes32" }, { "indexed": true, "name": "beneficiary", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" } ], "name": "ChannelLockedReturn", "type": "event" }, { "constant": false, "inputs": [ { "name": "participant", "type": "address" }, { "name": "partner", "type": "address" }, { "name": "settle_window", "type": "uint256" } ], "name": "openChannel", "outputs": [], "payable": true, "stateMutability": "payable", "type": "function" }, { "constant": false, "inputs": [ { "name": "participant", "type": "address" }, { "name": "partner", "type": "address" } ], "name": "setTotalDeposit", "outputs": [], "payable": true, "stateMutability": "payable", "type": "function" }, { "constant": false, "inputs": [ { "name": "participant1_address", "type": "address" }, { "name": "participant1_balance", "type": "uint256" }, { "name": "participant2_address", "type": "address" }, { "name": "participant2_balance", "type": "uint256" }, { "name": "participant1_signature", "type": "bytes" }, { "name": "participant2_signature", "type": "bytes" } ], "name": "cooperativeSettle", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "partner", "type": "address" }, { "name": "balanceHash", "type": "bytes32" }, { "name": "nonce", "type": "uint256" }, { "name": "signature", "type": "bytes" } ], "name": "closeChannel", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "closing", "type": "address" }, { "name": "balanceHash", "type": "bytes32" }, { "name": "nonce", "type": "uint256" }, { "name": "signature", "type": "bytes" } ], "name": "nonclosingUpdateBalanceProof", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "participant1", "type": "address" }, { "name": "participant1_transferred_amount", "type": "uint256" }, { "name": "participant1_locked_amount", "type": "uint256" }, { "name": "participant1_lock_id", "type": "uint256" }, { "name": "participant2", "type": "address" }, { "name": "participant2_transferred_amount", "type": "uint256" }, { "name": "participant2_locked_amount", "type": "uint256" }, { "name": "participant2_lock_id", "type": "uint256" } ], "name": "settleChannel", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "participant1", "type": "address" }, { "name": "participant2", "type": "address" }, { "name": "lockIdentifier", "type": "bytes32" } ], "name": "unlock", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "participant", "type": "address" }, { "name": "partner", "type": "address" } ], "name": "getChannelIdentifier", "outputs": [ { "name": "", "type": "bytes32" } ], "payable": false, "stateMutability": "view", "type": "function" } ];

const diceABI = [ { "constant": true, "inputs": [], "name": "revealWindow", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "bytes32" } ], "name": "roundIdentifier_to_diceInfo", "outputs": [ { "name": "positive", "type": "address" }, { "name": "negative", "type": "address" }, { "name": "betMask", "type": "uint256" }, { "name": "modulo", "type": "uint256" }, { "name": "initiatorHashR", "type": "bytes32" }, { "name": "acceptorR", "type": "bytes32" }, { "name": "state", "type": "uint8" }, { "name": "lastRevealBlock", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "_revealWindow", "type": "uint256" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "initiator", "type": "address" }, { "indexed": true, "name": "acceptor", "type": "address" }, { "indexed": false, "name": "roundIdentifier", "type": "bytes32" }, { "indexed": false, "name": "winner", "type": "address" } ], "name": "InitiatorSettled", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "initiator", "type": "address" }, { "indexed": true, "name": "acceptor", "type": "address" }, { "indexed": false, "name": "roundIdentifier", "type": "bytes32" }, { "indexed": false, "name": "lastRevealBlock", "type": "uint256" } ], "name": "AcceptorSettled", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "initiator", "type": "address" }, { "indexed": true, "name": "acceptor", "type": "address" }, { "indexed": false, "name": "roundIdentifier", "type": "bytes32" }, { "indexed": false, "name": "winner", "type": "address" } ], "name": "InitiatorRevealed", "type": "event" }, { "constant": false, "inputs": [ { "name": "channelIdentifier", "type": "bytes32" }, { "name": "round", "type": "uint256" }, { "name": "betMask", "type": "uint256" }, { "name": "modulo", "type": "uint256" }, { "name": "positive", "type": "address" }, { "name": "negative", "type": "address" }, { "name": "initiatorHashR", "type": "bytes32" }, { "name": "initiatorSignature", "type": "bytes" }, { "name": "acceptorR", "type": "bytes32" }, { "name": "acceptorSignature", "type": "bytes" }, { "name": "initiatorR", "type": "bytes32" } ], "name": "initiatorSettle", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "channelIdentifier", "type": "bytes32" }, { "name": "round", "type": "uint256" }, { "name": "betMask", "type": "uint256" }, { "name": "modulo", "type": "uint256" }, { "name": "positive", "type": "address" }, { "name": "negative", "type": "address" }, { "name": "initiatorHashR", "type": "bytes32" }, { "name": "initiatorSignature", "type": "bytes" }, { "name": "acceptorR", "type": "bytes32" } ], "name": "acceptorSettle", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "channelIdentifier", "type": "bytes32" }, { "name": "round", "type": "uint256" }, { "name": "initiatorR", "type": "bytes32" } ], "name": "initiatorReveal", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "roundIdentifier", "type": "bytes32" } ], "name": "getResult", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" } ];

const paymentData = "0x608060405234801561001057600080fd5b506040516060806132eb833981018060405281019080805190602001909291908051906020019092919080519060200190929190505050826000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508160058190555080600681905550505050613244806100a76000396000f3006080604052600436106100db576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630a798f24146100e05780630ab943e11461014057806318444694146101df5780635a1047461461020a57806377c5f23c146102355780637a7ebd7b146102a657806384a769b2146102f85780638568536a146103995780638a6e80181461049c578063938bcd67146104e15780639e45b47814610560578063b4778bea1461058b578063c3fe3e28146105e1578063c6bf4ec514610638578063ddfb48cb1461069d575b600080fd5b61013e600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061073e565b005b34801561014c57600080fd5b506101dd600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291908035906020019092919080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291908035906020019092919080359060200190929190505050610a68565b005b3480156101eb57600080fd5b506101f4610f2c565b6040518082815260200191505060405180910390f35b34801561021657600080fd5b5061021f610f32565b6040518082815260200191505060405180910390f35b34801561024157600080fd5b506102a4600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035600019169060200190929190505050610f38565b005b3480156102b257600080fd5b506102d56004803603810190808035600019169060200190929190505050611507565b604051808360ff1660ff1681526020018281526020019250505060405180910390f35b34801561030457600080fd5b50610397600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803560001916906020019092919080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611538565b005b3480156103a557600080fd5b5061049a600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611841565b005b3480156104a857600080fd5b506104cb6004803603810190808035600019169060200190929190505050611e3b565b6040518082815260200191505060405180910390f35b3480156104ed57600080fd5b50610542600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050611e53565b60405180826000191660001916815260200191505060405180910390f35b34801561056c57600080fd5b50610575612007565b6040518082815260200191505060405180910390f35b6105df600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919050505061200d565b005b3480156105ed57600080fd5b506105f66121a1565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561064457600080fd5b506106876004803603810190808035600019169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506121c6565b6040518082815260200191505060405180910390f35b3480156106a957600080fd5b5061073c600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803560001916906020019092919080359060200190929190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506121eb565b005b600080600083600654811115801561075857506005548110155b15156107cc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c696420736574746c652077696e646f77000000000000000000000081525060200191505060405180910390fd5b6107d68787612611565b935060006002600086600019166000191681526020019081526020016000205414151561086b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260168152602001807f6368616e6e656c20616c7265616479206578697374730000000000000000000081525060200191505060405180910390fd5b6000341115156108e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260208152602001807f73686f756c64206465706f736974207768656e206f70656e206368616e6e656c81525060200191505060405180910390fd5b600180600082825401925050819055506001546002600086600019166000191681526020019081526020016000208190555061091f8787611e53565b9250600160036000856000191660001916815260200190815260200160002060000160006101000a81548160ff021916908360ff160217905550846003600085600019166000191681526020019081526020016000206002018190555060036000846000191660001916815260200190815260200160002060010160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002091503482600001819055508573ffffffffffffffffffffffffffffffffffffffff168773ffffffffffffffffffffffffffffffffffffffff167ff43f324498a3f4dd1b8ffef6d6af08dc193c1707f7f669feacf8ff4e50fbdd3a858834604051808460001916600019168152602001838152602001828152602001935050505060405180910390a350505050505050565b6000806000806000610a7a8d8a611e53565b9450600360008660001916600019168152602001908152602001600020935060028460000160009054906101000a900460ff1660ff16141515610b25576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f6368616e6e656c2073746174652073686f6c6420626520636c6f73656400000081525060200191505060405180910390fd5b438460020154101515610ba0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260208152602001807f736574746c656d656e742077696e646f772073686f756c64206265206f76657281525060200191505060405180910390fd5b8360010160008e73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002092508360010160008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209150610c32838d8d8d612940565b610c3e82898989612940565b610c4d858e8d8d8d8c8c612a9d565b90508360010160008e73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000808201600090556001820160006101000a81549060ff02191690556002820160009055600382016000905550508360010160008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000808201600090556001820160006101000a81549060ff0219169055600282016000905560038201600090555050600360008660001916600019168152602001908152602001600020600080820160006101000a81549060ff02191690556002820160009055505060026000610d778f8c612611565b6000191660001916815260200190815260200160002060009055610d9d838d848b612d44565b809950819d5050508c73ffffffffffffffffffffffffffffffffffffffff166108fc8d9081150290604051600060405180830381858888f19350505050158015610deb573d6000803e3d6000fd5b508873ffffffffffffffffffffffffffffffffffffffff166108fc899081150290604051600060405180830381858888f19350505050158015610e32573d6000803e3d6000fd5b50806000191685600019167f51506def4da4e4946729d5e4857c7898b5037649a12445dcca8e885afb12e4698f8f604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a3806000191685600019167f51506def4da4e4946729d5e4857c7898b5037649a12445dcca8e885afb12e4698b8b604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a350505050505050505050505050565b60055481565b60015481565b600080600060046000856000191660001916815260200190815260200160002060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054925060046000856000191660001916815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205491506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663add4c784856040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808260001916600019168152602001915050602060405180830381600087803b15801561108b57600080fd5b505af115801561109f573d6000803e3d6000fd5b505050506040513d60208110156110b557600080fd5b8101908080519060200190929190505050905060008173ffffffffffffffffffffffffffffffffffffffff16141561123457600083111561118b578573ffffffffffffffffffffffffffffffffffffffff166108fc849081150290604051600060405180830381858888f19350505050158015611136573d6000803e3d6000fd5b508573ffffffffffffffffffffffffffffffffffffffff1684600019167f06fcb8f03d7121545713132681b1bf54af1ff9fcab01f34b23a6745f5ddbbce5856040518082815260200191505060405180910390a35b600082111561122f578473ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f193505050501580156111da573d6000803e3d6000fd5b508473ffffffffffffffffffffffffffffffffffffffff1684600019167f06fcb8f03d7121545713132681b1bf54af1ff9fcab01f34b23a6745f5ddbbce5846040518082815260200191505060405180910390a35b6114ff565b8573ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614156113b557600082111561130c578573ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f193505050501580156112b7573d6000803e3d6000fd5b508573ffffffffffffffffffffffffffffffffffffffff1684600019167f088f29dc1537a391127b5577fa9923ab8a3738bf3f4160d5c0ca098acec24a3e846040518082815260200191505060405180910390a35b60008311156113b0578573ffffffffffffffffffffffffffffffffffffffff166108fc849081150290604051600060405180830381858888f1935050505015801561135b573d6000803e3d6000fd5b508573ffffffffffffffffffffffffffffffffffffffff1684600019167f06fcb8f03d7121545713132681b1bf54af1ff9fcab01f34b23a6745f5ddbbce5856040518082815260200191505060405180910390a35b6114fe565b6000831115611459578473ffffffffffffffffffffffffffffffffffffffff166108fc849081150290604051600060405180830381858888f19350505050158015611404573d6000803e3d6000fd5b508473ffffffffffffffffffffffffffffffffffffffff1684600019167f088f29dc1537a391127b5577fa9923ab8a3738bf3f4160d5c0ca098acec24a3e856040518082815260200191505060405180910390a35b60008211156114fd578473ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f193505050501580156114a8573d6000803e3d6000fd5b508473ffffffffffffffffffffffffffffffffffffffff1684600019167f06fcb8f03d7121545713132681b1bf54af1ff9fcab01f34b23a6745f5ddbbce5846040518082815260200191505060405180910390a35b5b5b505050505050565b60036020528060005260406000206000915090508060000160009054906101000a900460ff16908060020154905082565b6000806000803388600061154c8383611e53565b9050600160036000836000191660001916815260200190815260200160002060000160009054906101000a900460ff1660ff161415156115f4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260168152602001807f6368616e6e656c2073686f756c64206265206f70656e0000000000000000000081525060200191505060405180910390fd5b6115fe338c611e53565b965060036000886000191660001916815260200190815260200160002095508560010160008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209450600089111561174c57611675878b8b8b612dcb565b93508a73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16141515611740576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001807f62616c616e63652070726f6f662073686f756c64206265207369676e6564206281526020017f7920706172746e6572000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b61174b858b8b612eca565b5b60028660000160006101000a81548160ff021916908360ff16021790555060018660010160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055504386600201600082825401925050819055503373ffffffffffffffffffffffffffffffffffffffff1687600019167fc385db978aebc30a2ab47905160e860a190999aab78e9c8d040ca5911f83eede8c60405180826000191660001916815260200191505060405180910390a35050505050505050505050565b600080600080898860006118558383611e53565b9050600160036000836000191660001916815260200190815260200160002060000160009054906101000a900460ff1660ff161415156118fd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260168152602001807f6368616e6e656c2073686f756c64206265206f70656e0000000000000000000081525060200191505060405180910390fd5b6119078d8c611e53565b9650611917878e8e8e8e8e612f60565b95508c73ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff161415156119e2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602a8152602001807f7369676e61747572652073686f756c64206265207369676e656420627920706181526020017f727469636970616e74310000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6119f0878e8e8e8e8d612f60565b95508a73ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff16141515611abb576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602a8152602001807f7369676e61747572652073686f756c64206265207369676e656420627920706181526020017f727469636970616e74320000000000000000000000000000000000000000000081525060400191505060405180910390fd5b60036000886000191660001916815260200190815260200160002094508460010160008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001548560010160008f73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154019350898c0184141515611c04576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260388152602001807f7468652073756d206f662062616c616e6365732073686f756c6420626520657181526020017f75616c20746f2074686520746f74616c206465706f736974000000000000000081525060400191505060405180910390fd5b8460010160008e73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000808201600090556001820160006101000a81549060ff02191690556002820160009055600382016000905550508460010160008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000808201600090556001820160006101000a81549060ff0219169055600282016000905560038201600090555050600360008860001916600019168152602001908152602001600020600080820160006101000a81549060ff02191690556002820160009055505060026000611d2c8f8e612611565b600019166000191681526020019081526020016000206000905560008c1115611d97578c73ffffffffffffffffffffffffffffffffffffffff166108fc8d9081150290604051600060405180830381858888f19350505050158015611d95573d6000803e3d6000fd5b505b60008a1115611de8578a73ffffffffffffffffffffffffffffffffffffffff166108fc8b9081150290604051600060405180830381858888f19350505050158015611de6573d6000803e3d6000fd5b505b86600019167f4c4399a084cb97d6d0f51a5481485cccd0eb35cf21aec6cf5140408b1b3d1bd88d8c604051808381526020018281526020019250505060405180910390a250505050505050505050505050565b60026020528060005260406000206000915090505481565b6000806000808573ffffffffffffffffffffffffffffffffffffffff1614158015611e95575060008473ffffffffffffffffffffffffffffffffffffffff1614155b8015611ecd57508373ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff1614155b1515611f41576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f696e76616c696420696e7075740000000000000000000000000000000000000081525060200191505060405180910390fd5b611f4b8585612611565b91506002600083600019166000191681526020019081526020016000205490508181604051602001808360001916600019168152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083101515611fd05780518252602082019150602081019050602083039250611fab565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209250505092915050565b60065481565b6000808383600061201e8383611e53565b9050600160036000836000191660001916815260200190815260200160002060000160009054906101000a900460ff1660ff161415156120c6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260168152602001807f6368616e6e656c2073686f756c64206265206f70656e0000000000000000000081525060200191505060405180910390fd5b6120d08787611e53565b945060036000866000191660001916815260200190815260200160002060010160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002093503484600001600082825401925050819055508673ffffffffffffffffffffffffffffffffffffffff1685600019167f0346e981e2bfa2366dc2307a8f1fa24779830a01121b1275fe565c6b98bb4d3486600001546040518082815260200191505060405180910390a350505050505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6004602052816000526040600020602052806000526040600020600091509150505481565b600080600080873360006121ff8383611e53565b9050600260036000836000191660001916815260200190815260200160002060000160009054906101000a900460ff1660ff161415156122a7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260188152602001807f6368616e6e656c2073686f756c6420626520636c6f736564000000000000000081525060200191505060405180910390fd5b60006001028a60001916141580156122bf5750600089115b1515612333576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f696e76616c69642062616c616e63652070726f6f66000000000000000000000081525060200191505060405180910390fd5b61233d338c611e53565b965060036000886000191660001916815260200190815260200160002095508560010160008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002094508460010160009054906101000a900460ff161515612425576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260188152602001807f706172746e65722073686f756c6420626520636c6f736572000000000000000081525060200191505060405180910390fd5b856002015443111515156124c7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001807f6368616e6e656c2073686f756c6420626520696e20736574746c656d656e742081526020017f77696e646f77000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6124d3878b8b8b612dcb565b93508a73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1614151561259e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260258152602001807f7369676e61747572652073686f756c64206265207369676e656420627920636c81526020017f6f73696e6700000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6125a9858b8b612eca565b3373ffffffffffffffffffffffffffffffffffffffff1687600019167f9402d324e62839355b4df4992553dcdef3d9451e87e9591f51a776388c04e4ca8c60405180826000191660001916815260200191505060405180910390a35050505050505050505050565b6000808373ffffffffffffffffffffffffffffffffffffffff1614158015612650575060008273ffffffffffffffffffffffffffffffffffffffff1614155b801561268857508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614155b15156126fc576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807f696e76616c696420696e7075740000000000000000000000000000000000000081525060200191505060405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161015612837578282604051602001808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c010000000000000000000000000281526014018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c01000000000000000000000000028152601401925050506040516020818303038152906040526040518082805190602001908083835b60208310151561280357805182526020820191506020810190506020830392506127de565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020905061293a565b8183604051602001808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c010000000000000000000000000281526014018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c01000000000000000000000000028152601401925050506040516020818303038152906040526040518082805190602001908083835b60208310151561290a57805182526020820191506020810190506020830392506128e5565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902090505b92915050565b60008060010285600201546000191614801561295c5750600084145b80156129685750600083145b80156129745750600082145b1561297e57612a96565b8383836040516020018084815260200183815260200182815260200193505050506040516020818303038152906040526040518082805190602001908083835b6020831015156129e357805182526020820191506020810190506020830392506129be565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902090508460020154600019168160001916141515612a95576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601e8152602001807f62616c616e636520686173682073686f756c6420626520636f7272656374000081525060200191505060405180910390fd5b5b5050505050565b600081851415612b40578785604051602001808360001916600019168152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083101515612b0c5780518252602082019150602081019050602083039250612ae7565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209050612c7f565b81851015612be5578782604051602001808360001916600019168152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083101515612bad5780518252602082019150602081019050602083039250612b88565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020905060009550612c7e565b8785604051602001808360001916600019168152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083101515612c4a5780518252602082019150602081019050602083039250612c25565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209050600092505b5b8560046000836000191660001916815260200190815260200160002060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508260046000836000191660001916815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550979650505050505050565b600080600080612d5487866130df565b809250819350505086811415612d945781866000015411612d79578560000154612d7b565b815b9150818860000154019350818660000154039250612dc0565b81886000015411612da9578760000154612dab565b815b91508188600001540393508186600001540192505b505094509492505050565b60008030868686604051602001808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c01000000000000000000000000028152601401846000191660001916815260200183600019166000191681526020018281526020019450505050506040516020818303038152906040526040518082805190602001908083835b602083101515612e865780518252602082019150602081019050602083039250612e61565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209050612ebf8184613102565b915050949350505050565b826003015481111515612f45576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f6e6f6e63652073686f756c64206265206d6f6e6f746f6e69630000000000000081525060200191505060405180910390fd5b81836002018160001916905550808360030181905550505050565b600080308888888888604051602001808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c0100000000000000000000000002815260140186600019166000191681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c010000000000000000000000000281526014018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c0100000000000000000000000002815260140182815260200196505050505050506040516020818303038152906040526040518082805190602001908083835b6020831015156130995780518252602082019150602081019050602083039250613074565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902090506130d28184613102565b9150509695505050505050565b6000808284116130f257838303846130f7565b828403835b915091509250929050565b6000806000806041855114151561311857600080fd5b6020850151925060408501519150606085015160001a9050601b8160ff16101561314357601b810190505b601b8160ff1614806131585750601c8160ff16145b151561316357600080fd5b600186828585604051600081526020016040526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000865af11580156131da573d6000803e3d6000fd5b50505060206040510351935060008473ffffffffffffffffffffffffffffffffffffffff161415151561320c57600080fd5b839350505050929150505600a165627a7a723058202af8248e794f53692fdf764ca2f59b248b1d183d950218f2236b40c18324073f0029";

const diceData = "0x608060405234801561001057600080fd5b506040516020806110c0833981016040525160015561108c806100346000396000f3006080604052600436106100775763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416633e03dc9d811461007c578063863d22c714610149578063add4c78414610170578063b22524c1146101a4578063ee4e16921461022b578063f29ada2f14610249575b600080fd5b34801561008857600080fd5b50604080516020600460e43581810135601f81018490048402850184019095528484526101479482359460248035956044359560643595608435600160a060020a039081169660a4359091169560c4359536956101049492939190920191819084018382808284375050604080516020601f818a01358b0180359182018390048302840183018552818452989b8a359b909a90999401975091955091820193509150819084018382808284375094975050933594506102b19350505050565b005b34801561015557600080fd5b5061015e610695565b60408051918252519081900360200190f35b34801561017c57600080fd5b5061018860043561069b565b60408051600160a060020a039092168252519081900360200190f35b3480156101b057600080fd5b50604080516020600460e43581810135601f81018490048402850184019095528484526101479482359460248035956044359560643595608435600160a060020a039081169660a4359091169560c4359536956101049492939190920191819084018382808284375094975050933594506107579350505050565b34801561023757600080fd5b506101476004356024356044356109d4565b34801561025557600080fd5b50610261600435610cdb565b60408051600160a060020a03998a168152979098166020880152868801959095526060860193909352608085019190915260a084015260ff1660c083015260e08201529051908190036101000190f35b60408051602080820184905282518083038201815291830192839052815160009384938493849391929182918401908083835b602083106103035780518252601f1990920191602091820191016102e4565b5181516020939093036101000a600019018019909116921691909117905260405192018290039091208c149250610387915050576040805160e560020a62461bcd02815260206004820152601c60248201527f696e69746961746f72522073686f756c6420626520636f727265637400000000604482015290519081900360640190fd5b6103978f8f8f8f8f8f8f8f610d2f565b9350600160a060020a03808516908c1614610422576040805160e560020a62461bcd02815260206004820152602760248201527f7369676e61747572652073686f756c64206265207369676e656420627920696e60448201527f69746961746f7200000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b308f8f8f8f8f8f8f8e604051602001808a600160a060020a0316600160a060020a03166c01000000000000000000000000028152601401896000191660001916815260200188815260200187815260200186815260200185600160a060020a0316600160a060020a03166c0100000000000000000000000002815260140184600160a060020a0316600160a060020a03166c010000000000000000000000000281526014018360001916600019168152602001826000191660001916815260200199505050505050505050506040516020818303038152906040526040518082805190602001908083835b6020831061052c5780518252601f19909201916020918201910161050d565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020925089600160a060020a031661056f8488610e19565b600160a060020a0316146105f3576040805160e560020a62461bcd02815260206004820152602760248201527f7369676e61747572652073686f756c64206265207369676e656420627920696e60448201527f69746961746f7200000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b6106018d8d878a8f8f610ef9565b915061060d8f8f610fda565b600081815260026020908152604091829020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0387811691821790925583518581529283015282519394508d169233927f512c626a39638d8845d1244c69032b4456ac2ba22c1502165be19374ee932081928290030190a3505050505050505050505050505050565b60015481565b6000818152602081905260408120600681015460ff166001141561073a576007810154431161073a576040805160e560020a62461bcd02815260206004820152602360248201527f72657665616c2074696d652077696e646f772073686f756c6420626520636c6f60448201527f7365640000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b5050600090815260026020526040902054600160a060020a031690565b6000808033600160a060020a038816146107bb576040805160e560020a62461bcd02815260206004820152601d60248201527f74782073686f756c64206265206d616465206279206163636570746f72000000604482015290519081900360640190fd5b6107cb8c8c8c8c8c8c8c8c610d2f565b9250600160a060020a0380841690891614610856576040805160e560020a62461bcd02815260206004820152602760248201527f7369676e61747572652073686f756c64206265207369676e656420627920696e60448201527f69746961746f7200000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b6108608c8c610fda565b915060008083600019166000191681526020019081526020016000209050898160020181905550888160030181905550878160000160006101000a815481600160a060020a030219169083600160a060020a03160217905550868160010160006101000a815481600160a060020a030219169083600160a060020a0316021790555085816004018160001916905550838160050181600019169055506001544301816007018190555060018160060160006101000a81548160ff021916908360ff1602179055508660026000846000191660001916815260200190815260200160002060006101000a815481600160a060020a030219169083600160a060020a0316021790555086600160a060020a031688600160a060020a03167f77d6c2556176bfe2b3d17a9fcb85f4ffdb2a97fa933a92a471297cec936d75098484600701546040518083600019166000191681526020018281526020019250505060405180910390a3505050505050505050505050565b60008060006109e38686610fda565b60008181526020819052604090206006810154919450925060ff16600114610a7b576040805160e560020a62461bcd02815260206004820152602260248201527f73746174652073686f756c642062652077616974696e6720666f72207265766560448201527f616c000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600482015460408051602080820188905282518083038201815291830192839052815191929182918401908083835b60208310610ac95780518252601f199092019160209182019101610aaa565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916141515610b51576040805160e560020a62461bcd02815260206004820152601c60248201527f696e69746961746f72522073686f756c6420626520636f727265637400000000604482015290519081900360640190fd5b6007820154431115610bd3576040805160e560020a62461bcd02815260206004820152602160248201527f72657665616c2074696d652077696e646f772073686f756c64206265206f706560448201527f6e00000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60028201546003830154600584015484546001860154610c0594939289929091600160a060020a039182169116610ef9565b6000848152600260208181526040808420805473ffffffffffffffffffffffffffffffffffffffff19908116600160a060020a038881169182179093558685528387208054831681556001818101805490941690935595860187905560038601879055600486018790556005860187905560068601805460ff1916905560079095019590955593870154875482518a815293840194909452815195965084169492909316927f58bd3f2c86e089a272400331a7430bfada3c33073ac9cb0bd56079aad1297cee92918290030190a3505050505050565b60006020819052908152604090208054600182015460028301546003840154600485015460058601546006870154600790970154600160a060020a03968716979690951695939492939192909160ff169088565b604080516c01000000000000000000000000308102602080840191909152603483018c9052605483018b9052607483018a905260948301899052600160a060020a03808916830260b4850152871690910260c883015260dc8083018690528351808403909101815260fc909201928390528151600093849392909182918401908083835b60208310610dd25780518252601f199092019160209182019101610db3565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209050610e0b8184610e19565b9a9950505050505050505050565b60008060008084516041141515610e2f57600080fd5b50505060208201516040830151606084015160001a601b60ff82161015610e5457601b015b8060ff16601b1480610e6957508060ff16601c145b1515610e7457600080fd5b60408051600080825260208083018085528a905260ff8516838501526060830187905260808301869052925160019360a0808501949193601f19840193928390039091019190865af1158015610ece573d6000803e3d6000fd5b5050604051601f190151945050600160a060020a0384161515610ef057600080fd5b50505092915050565b604080516020808201879052818301869052825180830384018152606090920192839052815160009384938493909282918401908083835b60208310610f505780518252601f199092019160209182019101610f31565b5181516020939093036101000a6000190180199091169216919091179052604051920182900390912094508a925084915050811515610f8b57fe5b06905060288811610fba57600281900a891664ffffffffff1615610fb157849250610fb5565b8392505b610fce565b88811015610fca57849250610fce565b8392505b50509695505050505050565b6040805160208082018590528183018490528251808303840181526060909201928390528151600093918291908401908083835b6020831061102d5780518252601f19909201916020918201910161100e565b5181516020939093036101000a6000190180199091169216919091179052604051920182900390912096955050505050505600a165627a7a72305820ff2ab97f96fb15df18deb9540ad77f107688b752aef3fa91f06af9db392528f20029"

const owner = "0xa08105d7650Fe007978a291CcFECbB321fC21ffe";
const ownerPrivateKey = new Buffer('6A22D7D5D87EFC4A1375203B7E54FBCF35FAA84975891C5E3D12BE86C579A6E5', 'hex');

async function main(diceRevealWindow, paymentWindowMin, paymentWindowMax) {

    var diceContract = await deploy(diceABI, diceData, [diceRevealWindow])

    if (diceContract != '0x0') {
        console.log("dice contract deployed: ", diceContract);
    } else {
        console.log("dice contract deployed failed");
        return;
    }

    var paymentContract = await deploy(paymentABI, paymentData, [diceContract, paymentWindowMin, paymentWindowMax]);

    if (paymentContract != '0x0') {
        console.log("payment contract deployed: ", paymentContract);
    } else {
        console.log("payment contract deployed failed");
        return;
    }

}

async function deploy(abi, data, args) {
    var myContract = new web3.eth.Contract(abi);
    data = myContract.deploy({data:data, arguments:args}).encodeABI();
    var nonce = await web3.eth.getTransactionCount(owner);

    var txData = {
        nonce: web3.utils.toHex(nonce),
        gasLimit: web3.utils.toHex(5000000),
        gasPrice: web3.utils.toHex(10e9), // 10 Gwei
        from: owner,
        data: data 
    }

    const transaction = new Tx(txData)
    transaction.sign(ownerPrivateKey)
    const serializedTx = transaction.serialize().toString('hex')
    let res = await web3.eth.sendSignedTransaction('0x' + serializedTx)

    if (res && res.status) {
        console.log("contract deployed: ", res);
        return res.contractAddress;
    } else {
        console.log("contract deployed failed");
        return "0x0";
    }
}

main(3, 3, 6);